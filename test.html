<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Chat</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
</head>
<body>
    <h2>與 Flask WebSocket 互動</h2>
    <input type="text" id="messageInput" placeholder="輸入你的訊息">
    <button onclick="sendMessage()">發送訊息</button>

    <h3>回應：</h3>
    <div id="response"></div>

    <script>
        // 連接到 Flask-SocketIO 伺服器
        const socket = io("127.0.0.1:5000/chat", { path: "/socket.io" });

        // 當 WebSocket 連接成功時
        socket.on("connect", function() {
            console.log("✅ 連接成功！");
            document.getElementById("response").innerHTML += "<p>✅ WebSocket 已連接！</p>";
        });

        // 監聽來自後端的 `bot_message` 事件
        socket.on("bot_message", function(data) {
            console.log("🤖 來自機器人的回應：", data.message);
            document.getElementById("response").innerHTML += `<p>🤖 ${data.message}</p>`;
        });

        // 當 WebSocket 斷線時
        socket.on("disconnect", function() {
            console.log("❌ 連線中斷");
            document.getElementById("response").innerHTML += "<p>❌ WebSocket 已斷開</p>";
        });

        // 發送訊息到 Flask-SocketIO
        function sendMessage() {
            const message = document.getElementById("messageInput").value;
            if (message.trim() !== "") {
                socket.emit("user_message", { message: message }); // 發送 `user_message` 事件
                document.getElementById("response").innerHTML += `<p>📝 你: ${message}</p>`;
                document.getElementById("messageInput").value = ""; // 清空輸入框
            } else {
                alert("請輸入訊息後再發送！");
            }
        }
    </script>
</body>
</html>
